# NAVER WORKS 통계 자동화 도구

NAVER WORKS 통계 페이지에서 여러 기관 계정으로 로그인 후, 통계 페이지별로 날짜 지정 → 그래프 캡처 → 엑셀 다운로드 → 통합 통계 생성까지 완전 자동화하는 도구입니다.

## 🚀 주요 기능

### 📊 데이터 수집 자동화
- **다중 계정 지원**: 12개 기관 계정 자동 처리
- **스마트 로그인**: 쿠키 기반 자동 로그인 및 2차 인증 지원
- **페이지별 처리**: 각 통계 페이지 타입에 맞는 최적화된 처리
- **자동 캡처**: 그래프 스크린샷 자동 저장
- **엑셀 다운로드**: 통계 데이터 엑셀 파일 자동 다운로드

### 📈 통계 분석 자동화
- **파일명 자동 매칭**: 날짜/시간이 포함된 파일명도 prefix 기반으로 최신 파일 자동 탐지
- **기관별 동적 표구조**: 기관별로 다른 상태별 구성원 수 항목을 자동으로 처리
- **단위 포함 값 처리**: "21.3 GB", "360.5 KB" 등 단위가 포함된 값도 정확한 최소/최대값 추출
- **항목명 매핑**: 엑셀 시트명, 컬럼명과 표구조의 차이를 자동으로 매핑
- **통합 통계 생성**: 모든 기관의 통계를 하나의 엑셀 파일로 통합
- **자동 폴더 생성**: 필요한 폴더가 없으면 자동으로 생성
- **디버깅 로그**: 각 단계별 상세한 로그로 문제 원인 파악 가능

## 📋 지원 기관

1. 기관A (example1.org)
2. 기관B (example2.org)
3. 기관C (example3.org)
4. 기관D (example4.org)
5. 기관E (example5.org)
6. 기관F (example6.org)
7. 기관G (example7.org)
8. 기관H (example8.org)
9. 기관I (example9.org)
10. 기관J (example10.org)
11. 기관K (example11.org)
12. 기관L (example12.org)

## 📊 지원 통계 페이지

### A. 그래프 2개인 페이지
- 계정 (구성원수, 활성사용자)
- 액티브 유저
- 공용용량
- 게시판

### B. 탭이 있는 그래프 1개 페이지
- 주소록 (외부연락처, 그룹)

### C. 일반 그래프 1개 페이지
- 메시지
- 캘린더
- 설문
- 할 일

### D. 메일 페이지 (특수)
- 보낸 메일 수
- 받은 메일 수

## 🛠️ 설치 방법

1. **Python 3.8+ 설치**
2. **Chrome 브라우저 설치**
3. **의존성 패키지 설치**:
   ```bash
   pip install -r requirements.txt
   ```

### 📦 필요한 패키지
- `selenium==4.15.2`: 웹 자동화
- `webdriver-manager==4.0.1`: Chrome 드라이버 관리
- `python-dateutil==2.8.2`: 날짜 처리
- `pandas`: 엑셀 파일 처리 및 데이터 분석
- `numpy`: 수치 계산
- `openpyxl`: 엑셀 파일 읽기/쓰기

## 🚀 사용 방법

### 1단계: 데이터 수집 자동화
```bash
python naverworks_automation.py
```

#### 계정 선택
프로그램 실행 시 사용 가능한 계정 목록이 표시됩니다. 번호를 입력하여 원하는 계정을 선택하세요.

#### 로그인
- 처음 실행 시: 수동으로 로그인 및 2차 인증을 완료한 후 Enter를 누르세요
- 이후 실행 시: 저장된 쿠키를 사용하여 자동 로그인됩니다

#### 자동 날짜 설정
실행하는 달의 전달 1일부터 말일까지로 자동 설정됩니다.
예: 2025년 1월에 실행하면 2024년 12월 1일 ~ 12월 31일

#### 자동 처리
선택한 계정의 모든 통계 페이지가 자동으로 처리됩니다.

### 2단계: 통합 통계 생성
```bash
python statistics_automation.py
```

#### 자동 처리
- `downloads/` 폴더 내 모든 기관 폴더를 순회하며 처리
- 각 기관별로 최신 엑셀 파일을 자동으로 찾아서 처리
- 기관별 특성에 맞는 동적 표구조 생성
- 단위 포함 값도 정확하게 최소/최대값 추출
- 결과를 `{기관명}_통계.xlsx` 파일로 저장

### 🚀 한번에 실행하기
1단계와 2단계를 연속으로 실행하려면 `run.bat` 파일을 실행하세요:
```bash
run.bat
```

이렇게 하면 데이터 수집부터 통합 통계 생성까지 모든 과정이 자동으로 완료됩니다.

## 📁 출력 파일 구조

```
downloads/
├── {기관명}/
│   ├── 계정_구성원수.png
│   ├── 계정_활성사용자.png
│   ├── 메일_보낸메일수.png
│   ├── 메일_받은메일수.png
│   ├── 통계/
│   │   └── (다운로드된 엑셀 파일들)
│   └── {기관명}_통계.xlsx  # 통합 통계 파일
```

## 🔧 설정 파일

### naverworks_accounts.py
계정 목록과 통계 페이지 URL을 관리하는 설정 파일입니다.

```python
# 계정 목록
ACCOUNTS = [
    "기관A (example1.org)",
    # ... 기타 계정들
]

# 통계 페이지 목록 (URL, 페이지명)
TARGET_PAGES = [
    ("https://demo.example.com/statistics/accounts", "계정"),
    # ... 기타 페이지들
]
```

### statistics_automation.py
통계 분석 자동화를 위한 설정 파일입니다.

```python
# 파일명 prefix 매핑
파일prefix매핑 = {
    "계정": "계정",
    "액티브 유저": "액티브 유저",
    # ... 기타 매핑
}

# 시트명 매핑
시트명매핑 = {
    "상태별 구성원 수": "상태별 구성원 수",
    # ... 기타 매핑
}

# 항목명 매핑
항목명매핑 = {
    "사용중": "사용중",
    "일시 정지": "일시정지",
    # ... 기타 매핑
}
```

## 🔐 로그인 URL 규칙

- **기관L (example12.org)**: https://demo.example.com
- **기관A (example1.org)**: https://demo.example.com/sso/user/login/view?agt_id=kiep-naver
- **그 외 모든 기관**: https://demo.example.com/kr/console/openapi/v2/app/list/view

## 📊 통계 분석 기능

### 기관별 동적 표구조
- **특이기관**: 한국청소년정책연구원, 한국행정연구원
  - 상태별 구성원 수: 사용중, 일시 정지, 접속 대기, 삭제
- **일반기관**: 나머지 10개 기관
  - 상태별 구성원 수: 사용중, 일시 정지, 미접속, 삭제

### 단위 포함 값 처리
- 용량 단위: GB, MB, KB, B
- 비율 단위: %
- 기타 단위: 자동 인식 및 처리

### 자동 매핑 기능
- 파일명 prefix 기반 최신 파일 탐지
- 시트명 자동 매핑
- 컬럼명 자동 매핑
- 누락된 데이터 자동 처리

### 디버깅 기능
- 서비스, 구분, 항목, 컬럼 존재 여부 로그
- 값 시리즈 내용 (앞 5개) 출력
- 최소/최대값 추출 결과 로그
- 단위 포함 값 처리 결과 로그

## 📝 주의사항

1. **2차 인증**: 처음 로그인 시 2차 인증(MFA)이 필요할 수 있습니다.
2. **쿠키 관리**: 쿠키는 `cookies/` 디렉토리에 저장되며, 만료 시 재로그인이 필요합니다.
3. **네트워크**: 안정적인 인터넷 연결이 필요합니다.
4. **권한**: 통계 페이지 접근 권한이 있는 계정만 사용 가능합니다.
5. **파일 구조**: 엑셀 파일이 `report/{기관명}/통계/` 폴더에 있어야 합니다.
6. **의존성**: pandas, numpy, openpyxl 패키지가 필요합니다.

## 🐛 문제 해결

### 로그인 실패
- 쿠키 파일을 삭제하고 재로그인을 시도하세요
- 2차 인증이 올바르게 완료되었는지 확인하세요

### 그래프 캡처 실패
- 페이지 로딩 시간을 늘려보세요
- 브라우저 창이 최소화되지 않았는지 확인하세요

### 다운로드 실패
- 브라우저의 다운로드 설정을 확인하세요
- 충분한 디스크 공간이 있는지 확인하세요

### 통계 분석 실패
- 엑셀 파일이 올바른 위치에 있는지 확인하세요
- 파일명이 예상 형식과 일치하는지 확인하세요
- 디버그 로그를 확인하여 구체적인 오류 원인을 파악하세요
- 필요한 패키지가 모두 설치되었는지 확인하세요

## 🔍 디버깅

### 로그 확인
통계 분석 과정에서 다음과 같은 디버그 정보가 출력됩니다:
- 서비스, 구분, 항목, 컬럼 존재 여부
- 값 시리즈 내용 (앞 5개)
- 최소/최대값 추출 결과
- 단위 포함 값 처리 결과

### 일반적인 문제
1. **메일 파일 누락**: 한국교육개발원 등 일부 기관의 메일 파일이 통계 폴더에 없을 수 있습니다.
2. **시트명 불일치**: 실제 엑셀 시트명과 매핑 테이블의 차이로 인한 문제
3. **컬럼명 불일치**: 실제 컬럼명과 매핑 테이블의 차이로 인한 문제
4. **패키지 누락**: pandas, numpy, openpyxl 패키지가 설치되지 않은 경우

### 패키지 설치 확인
```bash
pip install pandas numpy openpyxl
```

## 📈 향후 개선 계획

- 한글(.hwp) 파일 자동 입력 기능
- 웹 대시보드 인터페이스
- 실시간 모니터링 기능
- 추가 기관 지원
- requirements.txt 자동 업데이트